# PasteMark é¡¹ç›®è®°å¿†

## é¡¹ç›®æ¦‚è¿°

PasteMark æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„ VSCode æ’ä»¶ï¼Œç”¨äºåœ¨ Markdown æ–‡ä»¶ä¸­å¿«é€Ÿç²˜è´´å‰ªè´´æ¿å›¾ç‰‡ã€‚æ”¯æŒæ‰‹åŠ¨å‘½åå’Œ AI æ™ºèƒ½å‘½åä¸¤ç§æ¨¡å¼ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ğŸš€ ä¸€é”®ç²˜è´´ï¼ˆShift+Alt+Vï¼‰
- ğŸ¯ æ™ºèƒ½å‘½åï¼ˆé›†æˆ Ollama AIï¼‰
- ğŸ“ æ‰‹åŠ¨å‘½åï¼ˆé€‰ä¸­æ–‡æœ¬ä½œä¸ºæ–‡ä»¶åï¼‰
- ğŸ”§ é›¶é…ç½®ï¼ˆå¼€ç®±å³ç”¨ï¼‰

## æŠ€æœ¯æ¶æ„

### é¡¹ç›®ç»“æ„
```
src/
â”œâ”€â”€ extension.ts           # æ‰©å±•å…¥å£
â”œâ”€â”€ commands/              # å‘½ä»¤å¤„ç†
â”‚   â””â”€â”€ pasteImageCommand.ts
â”œâ”€â”€ clipboard/             # å‰ªè´´æ¿ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ types.ts          # æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ base.ts           # åŸºç±»å®ç°
â”‚   â”œâ”€â”€ clipboardManager.ts # ç»Ÿä¸€ç®¡ç†å™¨
â”‚   â”œâ”€â”€ windows.ts        # Windows å®ç°
â”‚   â”œâ”€â”€ macos.ts          # macOS å®ç°
â”‚   â”œâ”€â”€ linux.ts          # Linux å®ç°
â”‚   â””â”€â”€ wsl.ts            # WSL å®ç°
â”œâ”€â”€ services/              # æ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ editorService.ts  # ç¼–è¾‘å™¨æœåŠ¡
â”‚   â”œâ”€â”€ fileManager.ts    # æ–‡ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ imageProcessor.ts # å›¾ç‰‡å¤„ç†
â”‚   â””â”€â”€ ollamaClient.ts   # AI å®¢æˆ·ç«¯
â”œâ”€â”€ resources/             # ç³»ç»Ÿè„šæœ¬
â”‚   â”œâ”€â”€ windows-clipboard.ps1
â”‚   â”œâ”€â”€ mac-clipboard.applescript
â”‚   â””â”€â”€ linux-clipboard.sh
â”œâ”€â”€ types/                 # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
    â””â”€â”€ stringUtils.ts

tests/                     # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ unit/                 # å•å…ƒæµ‹è¯•
â”œâ”€â”€ integration/          # é›†æˆæµ‹è¯•
â””â”€â”€ e2e/                  # ç«¯åˆ°ç«¯æµ‹è¯•
```

### æŠ€æœ¯æ ˆ
- TypeScript 5.x
- VSCode Extension API
- Node.js 16.x+
- æµ‹è¯•æ¡†æ¶ï¼šVitest + @vscode/test-electron
- æ„å»ºå·¥å…·ï¼štsc + esbuild
- CI/CDï¼šGitHub Actions
- å¤–éƒ¨æœåŠ¡ï¼šOllama HTTP APIï¼ˆå¯é€‰ï¼‰

## å‰ªè´´æ¿å›¾ç‰‡è¯»å–å®ç°

### é—®é¢˜èƒŒæ™¯
VSCode Extension API åªæ”¯æŒ `vscode.env.clipboard.readText()` å’Œ `writeText()`ï¼Œä¸æ”¯æŒè¯»å–äºŒè¿›åˆ¶å›¾ç‰‡æ•°æ®ã€‚è¿™æ„å‘³ç€æ— æ³•ç›´æ¥ä»æˆªå›¾å·¥å…·ï¼ˆå¦‚ Windows Snipping Toolã€macOS Screenshotï¼‰è¯»å–å›¾ç‰‡ã€‚

### è§£å†³æ–¹æ¡ˆ
é€šè¿‡è°ƒç”¨ç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼å®ç°è·¨å¹³å°å‰ªè´´æ¿å›¾ç‰‡è¯»å–ï¼š

1. **Windows**: ä½¿ç”¨ PowerShell è„šæœ¬è°ƒç”¨ .NET Framework çš„ `System.Windows.Forms.Clipboard`
2. **macOS**: ä½¿ç”¨ AppleScript è¯»å–å‰ªè´´æ¿å›¾ç‰‡
3. **Linux**: ä½¿ç”¨ xclip (X11) æˆ– wl-paste (Wayland)
4. **WSL**: è°ƒç”¨ Windows çš„ PowerShellï¼Œå¹¶è½¬æ¢è·¯å¾„æ ¼å¼

### å®ç°ç»†èŠ‚
- **èµ„æºæ–‡ä»¶ç®¡ç†**ï¼šç³»ç»Ÿè„šæœ¬éœ€è¦åœ¨æ„å»ºæ—¶å¤åˆ¶åˆ° out/resources ç›®å½•
- **æ ¼å¼æ”¯æŒ**ï¼šWindows æ”¯æŒ PNGã€Bitmapã€DIB ç­‰å¤šç§å‰ªè´´æ¿æ ¼å¼
- **ä¸´æ—¶æ–‡ä»¶**ï¼šæ“ä½œå®Œæˆåè‡ªåŠ¨æ¸…ç†ï¼Œå³ä½¿å‡ºé”™ä¹Ÿä¼šå°è¯•æ¸…ç†
- **è·¯å¾„å¤„ç†**ï¼šWSL ç¯å¢ƒä¸‹çš„ Windows è·¯å¾„éœ€è¦è½¬æ¢ä¸º WSL è·¯å¾„æ ¼å¼
- **æƒé™è¦æ±‚**ï¼šLinux éœ€è¦å®‰è£… xclip æˆ– wl-clipboard

## Ollama é›†æˆ

### æ¨¡å‹é…ç½®
- é»˜è®¤æ¨¡å‹ï¼š`llava`
- æ”¯æŒæ¨¡å‹ï¼šæ‰€æœ‰ Ollama è§†è§‰æ¨¡å‹ï¼ˆä¸é™åˆ¶æ¨¡å‹é€‰æ‹©ï¼‰
  - å¸¸ç”¨ï¼šllavaã€llava:13bã€llava:34bã€llava-llama3
  - æ¨èï¼šqwen2-vlï¼ˆ2025å¹´æ¨èï¼Œä¸­è‹±æ–‡æ”¯æŒå¥½ï¼‰
  - æ–°æŠ€æœ¯ï¼špixtralã€moondream
  - è‡ªå®šä¹‰æ¨¡å‹ä¹Ÿå¯ä»¥ä½¿ç”¨
- æœåŠ¡åœ°å€ï¼š`http://localhost:11434`
- è¶…æ—¶è®¾ç½®ï¼š3ç§’
- å¯ç”¨æ€§ç¼“å­˜ï¼š1åˆ†é’Ÿ

### æ–‡ä»¶åç”Ÿæˆç­–ç•¥
1. **æ‰‹åŠ¨å‘½å**ï¼šé€‰ä¸­æ–‡æœ¬ â†’ ä½¿ç”¨é€‰ä¸­æ–‡æœ¬ä½œä¸ºæ–‡ä»¶å
2. **æ™ºèƒ½å‘½å**ï¼šæ— é€‰ä¸­æ–‡æœ¬ â†’ è°ƒç”¨ Ollama AI ç”Ÿæˆæè¿°æ€§æ–‡ä»¶å
3. **é™çº§ç­–ç•¥**ï¼šOllama ä¸å¯ç”¨ â†’ ä½¿ç”¨æ—¶é—´æˆ³å‘½åï¼ˆimage-20250115-143025.pngï¼‰

### æ–‡ä»¶åå¤„ç†
- **ç‰¹æ®Šå­—ç¬¦æ¸…ç†**ï¼šç§»é™¤ `/\:*?"<>|` ç­‰ä¸å®‰å…¨å­—ç¬¦
- **é•¿åº¦é™åˆ¶**ï¼šæœ€å¤§ 255 å­—ç¬¦
- **å»é‡æœºåˆ¶**ï¼šæ–‡ä»¶å­˜åœ¨æ—¶è‡ªåŠ¨æ·»åŠ æ•°å­—åç¼€ï¼ˆ-1ã€-2ã€-3...ï¼‰
- **è·¯å¾„æ ¼å¼**ï¼šç»Ÿä¸€ä½¿ç”¨æ­£æ–œæ 

### æç¤ºè¯é…ç½®
é»˜è®¤æç¤ºè¯ï¼š
```
Analyze this image and provide a short, descriptive filename (2-4 words, English, use hyphens to separate words, no file extension). For example: "user-interface-design" or "system-architecture". Only respond with the filename, nothing else.
```

ç”¨æˆ·å¯è‡ªå®šä¹‰æç¤ºè¯ä»¥æ”¯æŒä¸åŒè¯­è¨€å’Œå‘½åé£æ ¼ã€‚

## æµ‹è¯•ç­–ç•¥

### æµ‹è¯•æ¡†æ¶
- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼šVitest
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼š@vscode/test-electron + Playwright

### æµ‹è¯•è¦†ç›–
- å•å…ƒæµ‹è¯•ï¼š60%ï¼ˆç‹¬ç«‹å‡½æ•°å’Œç±»ï¼‰
- é›†æˆæµ‹è¯•ï¼š30%ï¼ˆæ¨¡å—é—´äº¤äº’ï¼‰
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼š10%ï¼ˆå®Œæ•´ç”¨æˆ·æµç¨‹ï¼‰

### å½“å‰æµ‹è¯•çŠ¶æ€
- æµ‹è¯•æ¡†æ¶ï¼šVitest + @vscode/test-electron
- æµ‹è¯•ç”¨ä¾‹ï¼š78ä¸ª
- ä»£ç è¦†ç›–ç‡ï¼š55.91%
- æµ‹è¯•ç¯å¢ƒï¼šéœ€è¦ Xvfbï¼ˆLinux CIï¼‰
- æµ‹è¯•è¶…æ—¶ï¼š10åˆ†é’Ÿ

## é…ç½®é€‰é¡¹

```json
{
  "pastemark.ollamaEnabled": true,          // å¯ç”¨/ç¦ç”¨ Ollama
  "pastemark.ollamaEndpoint": "http://localhost:11434",  // Ollama æœåŠ¡åœ°å€
  "pastemark.ollamaModel": "llava",         // ä½¿ç”¨çš„æ¨¡å‹ï¼ˆæ”¯æŒä»»ä½•è§†è§‰æ¨¡å‹ï¼‰
  "pastemark.ollamaPrompt": "...",          // è‡ªå®šä¹‰æç¤ºè¯
  "pastemark.imagePath": "./",              // å›¾ç‰‡ä¿å­˜è·¯å¾„ï¼ˆç›¸å¯¹äºå½“å‰æ–‡ä»¶ï¼‰
  "pastemark.imageFormat": "png"            // é»˜è®¤å›¾ç‰‡æ ¼å¼ï¼ˆpng/jpg/jpeg/gif/bmpï¼‰
}
```

### è·¯å¾„é…ç½®ç¤ºä¾‹
- `"./"`ï¼šå½“å‰æ–‡ä»¶ç›®å½•ï¼ˆé»˜è®¤ï¼‰
- `"./images/"`ï¼šå½“å‰æ–‡ä»¶çš„ images å­ç›®å½•
- `"../assets/"`ï¼šä¸Šçº§ç›®å½•çš„ assets æ–‡ä»¶å¤¹

## é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

### å¤šå±‚å›é€€æœºåˆ¶
1. Ollama æœåŠ¡ä¸å¯ç”¨ â†’ æ—¶é—´æˆ³å‘½å
2. ç½‘ç»œè¶…æ—¶ï¼ˆ3ç§’ï¼‰â†’ æ—¶é—´æˆ³å‘½å
3. æ¨¡å‹è¿”å›ç©ºç»“æœ â†’ æ—¶é—´æˆ³å‘½å
4. å‰ªè´´æ¿è¯»å–å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
5. æ–‡ä»¶ä¿å­˜å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### æ€§èƒ½ä¼˜åŒ–
- **æœåŠ¡ç¼“å­˜**ï¼šOllama å¯ç”¨æ€§æ£€æŸ¥ç¼“å­˜ 1 åˆ†é’Ÿ
- **è¶…æ—¶æ§åˆ¶**ï¼šAI è¯·æ±‚ 3 ç§’è¶…æ—¶
- **å†…å­˜ç®¡ç†**ï¼šåŠæ—¶é‡Šæ”¾ Buffer å’Œæ¸…ç†ä¸´æ—¶æ–‡ä»¶
- **å¹¶å‘æ§åˆ¶**ï¼šé¿å…é‡å¤çš„æœåŠ¡æ£€æŸ¥

## å¼€å‘çŠ¶æ€

### å·²å®ŒæˆåŠŸèƒ½
- âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆå‰ªè´´æ¿å›¾ç‰‡æ£€æµ‹ã€æ–‡ä»¶ä¿å­˜ã€Markdown è¯­æ³•ç”Ÿæˆï¼‰
- âœ… æ‰‹åŠ¨å‘½åæ¨¡å¼ï¼ˆé€‰ä¸­æ–‡æœ¬ä½œä¸ºå›¾ç‰‡åï¼‰
- âœ… æ™ºèƒ½å‘½åæ¨¡å¼ï¼ˆOllama AI é›†æˆï¼‰
- âœ… é™çº§ç­–ç•¥ï¼ˆOllama ä¸å¯ç”¨æ—¶ä½¿ç”¨æ—¶é—´æˆ³ï¼‰
- âœ… å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… æ¨¡å—åŒ–æ¶æ„è®¾è®¡
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆWindowsã€macOSã€Linuxã€WSLï¼‰
- âœ… å®Œæ•´çš„æ‰©å±•å…¥å£å®ç°
- âœ… è¾“å‡ºé€šé“æ—¥å¿—è®°å½•
- âœ… æ–‡ä»¶åå»é‡æœºåˆ¶
- âœ… é”™è¯¯å›æ»šæœºåˆ¶
- âœ… ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†
- âœ… è·¯å¾„éªŒè¯å’Œåˆ›å»º
- âœ… CI/CD æµç¨‹ï¼ˆGitHub Actionsï¼‰
- âœ… ç»Ÿä¸€çš„æ¶ˆæ¯ç®¡ç†ç³»ç»Ÿ

### å·²å®ç°çš„æ ¸å¿ƒç»„ä»¶
- âœ… extension.ts ä¸»å…¥å£æ–‡ä»¶
- âœ… å®Œæ•´çš„å‘½ä»¤æ³¨å†Œå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… è¾“å‡ºé€šé“æ—¥å¿—è®°å½•
- âœ… èµ„æºæ–‡ä»¶è‡ªåŠ¨å¤„ç†

### è®¡åˆ’ä¸­çš„åŠŸèƒ½
- ğŸš€ æ”¯æŒæ›´å¤šå›¾ç‰‡æ ¼å¼ï¼ˆWebPã€TIFFï¼‰
- ğŸš€ å›¾ç‰‡å‹ç¼©é€‰é¡¹
- ğŸš€ æ‰¹é‡ç²˜è´´åŠŸèƒ½
- ğŸš€ å›¾ç‰‡æ°´å°åŠŸèƒ½
- ğŸš€ å†å²è®°å½•ç®¡ç†

### é¡¹ç›®æ–‡æ¡£
- README.md - é¡¹ç›®ä»‹ç»å’Œä½¿ç”¨è¯´æ˜
- ARCHITECTURE.md - æ¶æ„è®¾è®¡æ–‡æ¡£
- DEPLOYMENT.md - éƒ¨ç½²å’Œ CI/CD æ–‡æ¡£
- CHANGELOG.md - ç‰ˆæœ¬æ›´æ–°è®°å½•
- research/ - æŠ€æœ¯ç ”ç©¶æ–‡æ¡£

## å‘½ä»¤æ‰§è¡Œæµç¨‹

1. **å‘½ä»¤æ³¨å†Œ**ï¼š`extension.ts` æ³¨å†Œ `pastemark.pasteImage` å‘½ä»¤
2. **ç¯å¢ƒæ£€æŸ¥**ï¼šEditorService æ£€æŸ¥æ˜¯å¦åœ¨ Markdown æ–‡ä»¶ä¸­
3. **å‰ªè´´æ¿æ£€æµ‹**ï¼šClipboardManager æ£€æµ‹å¹¶è¯»å–å›¾ç‰‡
4. **æ–‡ä»¶åç”Ÿæˆ**ï¼šImageProcessor æ ¹æ®é…ç½®ç”Ÿæˆæ–‡ä»¶å
5. **æ–‡ä»¶ä¿å­˜**ï¼šFileManager ä¿å­˜å›¾ç‰‡åˆ°æŒ‡å®šè·¯å¾„
6. **æ’å…¥å¼•ç”¨**ï¼šEditorService æ’å…¥ Markdown å›¾ç‰‡è¯­æ³•
7. **æ¸…ç†ä¸´æ—¶æ–‡ä»¶**ï¼šClipboardManager æ¸…ç†ä¸´æ—¶æ–‡ä»¶
8. **é”™è¯¯å¤„ç†**ï¼šå¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œå›æ»šå·²åˆ›å»ºçš„æ–‡ä»¶

## æ¶ˆæ¯ç®¡ç†ç³»ç»Ÿ

### ç³»ç»Ÿæ¶æ„
é¡¹ç›®é‡‡ç”¨ç»Ÿä¸€çš„æ¶ˆæ¯ç®¡ç†ç³»ç»Ÿï¼Œæ‰€æœ‰ç”¨æˆ·é€šçŸ¥éƒ½é€šè¿‡ä¸“é—¨çš„æœåŠ¡ç±»è¿›è¡Œç®¡ç†ï¼š

- **æ¶ˆæ¯å¸¸é‡æ–‡ä»¶**ï¼š`src/constants/messages.ts` - å®šä¹‰æ‰€æœ‰æ¶ˆæ¯æ–‡æœ¬
- **æ¶ˆæ¯æœåŠ¡ç±»**ï¼š`src/services/messageService.ts` - ç»Ÿä¸€çš„æ¶ˆæ¯æ˜¾ç¤ºæ¥å£
- **æ¶ˆæ¯åˆ†ç±»**ï¼šé”™è¯¯æ¶ˆæ¯ã€è­¦å‘Šæ¶ˆæ¯ã€ä¿¡æ¯æ¶ˆæ¯ã€è¿›åº¦æ¶ˆæ¯

### è®¾è®¡ä¼˜åŠ¿
1. **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰é€šçŸ¥æ¶ˆæ¯é›†ä¸­å®šä¹‰ï¼Œä¾¿äºç»´æŠ¤å’Œå›½é™…åŒ–
2. **ç±»å‹å®‰å…¨**ï¼šæä¾›ç±»å‹å®‰å…¨çš„æ¶ˆæ¯æ˜¾ç¤ºæ–¹æ³•
3. **ä¾¿æ·æ–¹æ³•**ï¼šä¸ºå¸¸ç”¨æ¶ˆæ¯æä¾›ä¸“é—¨çš„ä¾¿æ·æ–¹æ³•
4. **æ—¥å¿—é›†æˆ**ï¼šè‡ªåŠ¨è®°å½•æ‰€æœ‰æ¶ˆæ¯åˆ°è¾“å‡ºé€šé“å’Œæ§åˆ¶å°
5. **è¿›åº¦æ”¯æŒ**ï¼šç»Ÿä¸€çš„è¿›åº¦æ˜¾ç¤ºæ¥å£

### ä½¿ç”¨æ–¹å¼
```typescript
// åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–
this.messageService = new MessageService(outputChannel);

// æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
this.messageService.showFailedToSaveImageError(error);

// æ˜¾ç¤ºä¿¡æ¯æ¶ˆæ¯
this.messageService.showImageSavedInfo(fileName);

// æ˜¾ç¤ºè¿›åº¦
this.messageService.showGenerateFileNameProgress(async (progress) => {
  // è¿›åº¦ä»»åŠ¡
});
```

## æ„å»ºå’Œæµ‹è¯•

### æ„å»ºè„šæœ¬
- `npm run compile` - ç¼–è¯‘ TypeScript ä»£ç 
- `npm run compile:e2e` - ç¼–è¯‘ç«¯åˆ°ç«¯æµ‹è¯•
- `npm run copy-resources` - å¤åˆ¶èµ„æºæ–‡ä»¶
- `npm run watch` - ç›‘è§†æ¨¡å¼ç¼–è¯‘

### æµ‹è¯•è„šæœ¬
- `npm run test` - è¿è¡Œå…¨éƒ¨æµ‹è¯•
- `npm run test:unit` - è¿è¡Œå•å…ƒæµ‹è¯•
- `npm run test:integration` - è¿è¡Œé›†æˆæµ‹è¯•
- `npm run test:e2e` - è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
- `npm run test:coverage` - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

### ä»£ç è´¨é‡
- `npm run lint` - è¿è¡Œ ESLint æ£€æŸ¥
- `npm run lint:fix` - è¿è¡Œ ESLint æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤
- `npm run typecheck` - è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥
- `npm run check` - è¿è¡Œå®Œæ•´çš„è´¨é‡æ£€æŸ¥ï¼ˆlint + typecheck + testï¼‰

## ç‰ˆæœ¬ä¿¡æ¯

- å½“å‰ç‰ˆæœ¬ï¼š0.1.1
- æœ€åæ›´æ–°ï¼š2025-07-16

- Node.js æœ€ä½ç‰ˆæœ¬ï¼š16.x
- VSCode æœ€ä½ç‰ˆæœ¬ï¼š1.74.0
- å‘å¸ƒè€…ï¼šyarnovo
- ä»“åº“ï¼šhttps://github.com/yarnovo/pastemark

## CI/CD çŠ¶æ€

- GitHub Actions å·¥ä½œæµï¼š`.github/workflows/ci-cd.yaml`
- CI è§¦å‘ï¼špush åˆ° mainã€PRã€æ‰‹åŠ¨è§¦å‘
- CD è§¦å‘ï¼šåˆ›å»º v* æ ‡ç­¾ï¼ˆå¦‚ v1.0.0ï¼‰
- å‘å¸ƒç›®æ ‡ï¼šVSCode Marketplace + GitHub Release